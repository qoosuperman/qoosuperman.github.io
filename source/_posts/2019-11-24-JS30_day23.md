---
title: "JS30 day23 Speech Synthesis"
catalog: true
toc_nav_num: true
date: 2019-11-24 22:26:24
subtitle: ""
header-img: "https://images.unsplash.com/photo-1569271532860-dd35503aaf1f?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1951&q=80"
tags:
- Javascript
catagories:
- Javascript
updateDate: 2019-11-24 22:26:24
# top: 1

---
# JS30 day23 - Speech Synthesis

## ä½œæ¥­å…§å®¹

æœ€è¿‘åšçš„éƒ½è·Ÿè²éŸ³æœ‰é—œï¼Œé›–ç„¶æ¦‚å¿µä¸Šä¸è¤‡é›œä½†æˆ‘è¦ºå¾— Google èƒ½æŠŠé€™å€‹æ±è¥¿å¯¦ä½œå‡ºä¾†æ”¾åœ¨ç€è¦½å™¨çœŸçš„å¤ªçŒ›äº†å§ =  =ï¼Œé€™å€‹ä½œæ¥­è‡ªå·±è¦ºå¾—æ¯”è¼ƒé›£çš„éƒ¨åˆ†æ˜¯ç†è§£æ•´å€‹ google ç³»çµ±æ˜¯æ€éº¼æŠŠè²éŸ³çš„è³‡è¨Šçµåˆæˆç‰©ä»¶
![](https://i.imgur.com/wyvNVW8.png)

## å­¸åˆ°ä»€éº¼

- JS
  1. `SpeechSynthesisUtterance()` ç‰©ä»¶ç‚º Web Speech API ä¸­ä»£è¡¨ä¸€ç™¼éŸ³çš„éœ€æ±‚ï¼Œç¿»æˆç™½è©±æ–‡å°±æ˜¯ä¸€æ®µè©±çš„è³‡è¨Šï¼Œä¾‹å¦‚å…§å®¹ï¼Œèªè¨€ã€éŸ³èª¿ã€è²éŸ³ã€é€Ÿç‡ç­‰ï¼Œæˆ‘å€‘å¯ä»¥é€é console log çœ‹çœ‹é€™å€‹ç‰©ä»¶çš„çµ„æˆï¼š
  ```
  SpeechSynthesisUtteranceÂ {text: "", lang: "", voice: null, volume: -1, rate: -1,Â â€¦}
  ```
  ç™¼å‡ºè²éŸ³çš„æ–¹å¼æ˜¯ç”¨ä¸‹é¢çš„æ–¹å¼ä¾†èªªï¼š
  ```js
  SpeechSynthesis.speak(<SpeechSynthesisUtteranceå¯¦é«”>)
  ```
  ä¸Šé¢é€™å¥çš„ `SpeechSynthesis` ä»‹é¢æ˜¯èªéŸ³åˆæˆä¼ºæœå™¨çš„æ§åˆ¶å™¨ï¼Œå¯é€éå…¶ä¾†å–å¾—å¯ä½¿ç”¨çš„èªéŸ³åˆæˆè³‡è¨Šï¼Œä¸¦æ’­æ”¾æˆ–æš«åœç™¼éŸ³ç­‰ç›¸é—œåŠŸèƒ½
  <br>

  2. `speechSynthesis.addEventListener('voiceschanged', populatVoices)`
  voiceschanged äº‹ä»¶æ˜¯ç•¶ `SpeechSynthesis.getVoices()` æ”¹è®Šæ™‚è¢«è§¸ç™¼ï¼Œå®ƒä¹Ÿæ˜¯ SpeechSynthesis å”¯ä¸€çš„ä¸€å€‹äº‹ä»¶ã€‚
  é€™è£¡æœƒè¢«è§¸ç™¼ï¼ŒBos æ˜¯èªªå› ç‚º SpeechSynthesis è¢«è®€å–æ‰€ä»¥è§¸ç™¼äº†é€™å€‹äº‹ä»¶
  <br>
  3. `SpeechSynthesis.getVoices()`ï¼šå–å¾—ä¸€é™£åˆ—ï¼Œå…¶ä¸­åŒ…å«ç›®å‰æ‰€æœ‰çš„ SpeechSynthesisVoice ç‰©ä»¶ï¼Œå…¶è£¡é ­çš„å±¬æ€§ç‚ºç•¶ä¸‹ç’°å¢ƒæ”¯æ´çš„æ‰€æœ‰ç™¼éŸ³è³‡è¨Šï¼Œæ™šé»å¿…é ˆé¸æ“‡å…¶ä¸­ä¸€å€‹çµ¦ msg é€™å€‹å¯¦é«”æ‰æœ‰è¾¦æ³•ç™¼å‡ºè²éŸ³
  
  ```js
  function populateVoices(){
    voices = this.getVoices()
    console.log(voices)
  }
  ```
  ![](https://i.imgur.com/hq4T4iD.png)

  åƒè€ƒè³‡æ–™ï¼šhttps://ithelp.ithome.com.tw/articles/10196799

  4. ç¾åœ¨è¦åšå‡ºåœ¨ä¸‹æ‹‰é¸å–®é¸æ“‡ä¸åŒèªè¨€å°±è¦ç™¼å‡ºä¸åŒèªè¨€çš„è²éŸ³
  ```js
  function setVoice(){
    msg.voice = voices.find(voice => voice.name === this.value)
  }
  voicesDropdown.addEventListener('change', setVoice)
  ```

  5. åšå‡ºåˆ‡æ›èªè¨€åŒæ™‚ç›´æ¥ä¸­æ®µå‰ä¸€å€‹ç„¶å¾Œç™¼è²éŸ³
  ```js
  function setVoice(){
    msg.voice = voices.find(voice => voice.name === this.value)
    toggle()
  }

  function toggle(startOver = true){
    speechSynthesis.cancel()
    if (startOver){
      speechSynthesis.speak(msg)
    }
  }
  ```
  6. ç›£è½ scroll bar è·Ÿ text è®ŠåŒ–
  ```js
  function setOption(){
    console.log(this.name, this.value);
    msg[${this.name}] = this.value;
    toggle();
  }
  options.forEach(option => {
    option.addEventListener('change', setOption)
  })
  ```
  ![](https://i.imgur.com/eO8xkik.png)

  7. ç¶å®š stopButton äº‹ä»¶çš„æ™‚å€™æ³¨æ„ä¸èƒ½é€™æ¨£å¯«
  ```js
  stopButton.addEventListener('click', toggle(false))  
  ```
  é€™æ¨£æœƒåªæœ‰åœ¨ä¸€é–‹å§‹çš„æ™‚å€™è§¸ç™¼ä¸€æ¬¡ï¼ŒæŒ‰éµæœ¬èº«æ²’ä½œç”¨ï¼Œæ‰€ä»¥æœ‰å…©ç¨®å¯«æ³•
  `bind()` æœƒç”Ÿæˆä¸€å€‹æ–°çš„ç¶å®šå‡½å¼ï¼Œç¬¬ä¸€å€‹å€¼æ˜¯ this çš„å€¼ï¼Œå¾Œé¢çš„æ‰æ˜¯ç¬¬ 1,2,3...å€‹åƒæ•¸
  ```js
  stopButton.addEventListener('click', toggle.bind(null, false))  
  // æˆ–è€…
  stopButton.addEventListener('click', () => toggle(false))  
  ```

  8. ç¶“éè‡ªå·±åˆ†æä¹‹å¾Œï¼Œç™¼å‡ºè²éŸ³çš„æ­¥é©Ÿå¯ä»¥æ‹†è§£å¦‚ä¸‹å¦‚ä¸‹
  ```js
  //1.æŠŠç€è¦½å™¨å¯ä»¥ç™¼å‡ºçš„è²éŸ³åˆ—å‡ºä¾†ï¼Œæ”¾åœ¨ä¸‹æ‹‰é¸å–®(window æœƒæ¯” mac å°‘)ï¼Œé€™é‚Šçš„ this æ˜¯ speechSynthesis
  voices = this.getVoices()
  //2.æ ¹æ“šä½¿ç”¨è€…é¸çš„ä¸‹æ‹‰é¸å–®ï¼ŒæŠŠæŒ‡å®šçš„é€™å€‹ vioce ç‰©ä»¶å¡å›å»çµ¦ SpeechSynthesisUtterance ç”Ÿå‡ºä¾†çš„å¯¦é«” msg
  msg.voice = voices.find(voice => voice.name === this.value)
  //3.æ ¹æ“š input ä¸åŒæ”¹è®Šé€™æ®µ msg çš„å…§å®¹ / é€Ÿåº¦ / éŸ³é«˜ 
  msg[this.name] = this.value 
  //4.åŒ…è£æˆ toggle function ç™¼å‡ºè²éŸ³ï¼Œå¦‚æœå‚³å…¥çš„åƒæ•¸æ˜¯ false å°±å¯ä»¥ä¸ç™¼å‡ºè²éŸ³
  function toggle(startOver = true){
    speechSynthesis.cancel()
    if (startOver){
      speechSynthesis.speak(msg)
    }
  }
  ```
  
åƒè€ƒè³‡æ–™ï¼š
https://github.com/wesbos/JavaScript30

## code å…§å®¹ï¼š
HTML:
```html
<div class="voiceinator">

      <h1>The Voiceinator 5000</h1>

      <select name="voice" id="voices">
        <option value="">Select A Voice</option>
      </select>

      <label for="rate">Rate:</label>
      <input name="rate" type="range" min="0" max="3" value="1" step="0.1">

      <label for="pitch">Pitch:</label>

      <input name="pitch" type="range" min="0" max="2" step="0.1">
      <textarea name="text">Hello! I love JavaScript ğŸ‘</textarea>
      <button id="stop">Stop!</button>
      <button id="speak">Speak</button>
<option value=""></option>
```
CSS:
```css
html {
  font-size: 10px;
  box-sizing: border-box;
}

*, *:before, *:after {
  box-sizing: inherit;
}

body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
  background-color: #3BC1AC;
  display: flex;
  min-height: 100vh;
  align-items: center;

  background-image:
  radial-gradient(circle at 100% 150%, #3BC1AC 24%, #42D2BB 25%, #42D2BB 28%, #3BC1AC 29%, #3BC1AC 36%, #42D2BB 36%, #42D2BB 40%, transparent 40%, transparent),
  radial-gradient(circle at 0    150%, #3BC1AC 24%, #42D2BB 25%, #42D2BB 28%, #3BC1AC 29%, #3BC1AC 36%, #42D2BB 36%, #42D2BB 40%, transparent 40%, transparent),
  radial-gradient(circle at 50%  100%, #42D2BB 10%, #3BC1AC 11%, #3BC1AC 23%, #42D2BB 24%, #42D2BB 30%, #3BC1AC 31%, #3BC1AC 43%, #42D2BB 44%, #42D2BB 50%, #3BC1AC 51%, #3BC1AC 63%, #42D2BB 64%, #42D2BB 71%, transparent 71%, transparent),
  radial-gradient(circle at 100% 50%, #42D2BB 5%, #3BC1AC 6%, #3BC1AC 15%, #42D2BB 16%, #42D2BB 20%, #3BC1AC 21%, #3BC1AC 30%, #42D2BB 31%, #42D2BB 35%, #3BC1AC 36%, #3BC1AC 45%, #42D2BB 46%, #42D2BB 49%, transparent 50%, transparent),
  radial-gradient(circle at 0    50%, #42D2BB 5%, #3BC1AC 6%, #3BC1AC 15%, #42D2BB 16%, #42D2BB 20%, #3BC1AC 21%, #3BC1AC 30%, #42D2BB 31%, #42D2BB 35%, #3BC1AC 36%, #3BC1AC 45%, #42D2BB 46%, #42D2BB 49%, transparent 50%, transparent);
  background-size:100px 50px;
}

.voiceinator {
  padding: 2rem;
  width: 50rem;
  margin: 0 auto;
  border-radius: 1rem;
  position: relative;
  background: white;
  overflow: hidden;
  z-index: 1;
  box-shadow: 0 0 5px 5px rgba(0,0,0,0.1);
}

h1 {
  width: calc(100% + 4rem);
  margin: -2rem 0 2rem -2rem;
  padding: .5rem;
  background: #ffc600;
  border-bottom: 5px solid #F3C010;
  text-align: center;
  font-size: 5rem;
  font-weight: 100;
  font-family: 'Pacifico', cursive;
  text-shadow: 3px 3px 0 #F3C010;
}

.voiceinator input,
.voiceinator button,
.voiceinator select,
.voiceinator textarea {
  width: 100%;
  display: block;
  margin: 10px 0;
  padding: 10px;
  border: 0;
  font-size: 2rem;
  background: #F7F7F7;
  outline: 0;
}

textarea {
  height: 20rem;
}

input[type="select"] {

}

.voiceinator button {
  background: #ffc600;
  border: 0;
  width: 49%;
  float: left;
  font-family: 'Pacifico', cursive;
  margin-bottom: 0;
  font-size: 2rem;
  border-bottom: 5px solid #F3C010;
  cursor: pointer;
  position: relative;
}

.voiceinator button:active {
  top: 2px;
}

.voiceinator button:nth-of-type(1) {
  margin-right: 2%;
}

```
JS:
```js
const msg = new SpeechSynthesisUtterance();
let voices = [];
const voicesDropdown = document.querySelector('[name="voice"]');
const options = document.querySelectorAll('[type="range"], [name="text"]');
const speakButton = document.querySelector('#speak');
const stopButton = document.querySelector('#stop');
msg.text = document.querySelector('[name="text"]').value

function populateVoices(){
  voices = this.getVoices()
  const voiceOptions = voices
    .map( voice => { return `<option value="${voice.name}">${voice.name}(${voice.lang})</option>`})
    .join('')
  voicesDropdown.innerHTML = voiceOptions
}

function setVoice(){
  msg.voice = voices.find(voice => voice.name === this.value)
  toggle()
}

function toggle(startOver = true){
  speechSynthesis.cancel()
  if (startOver){
    speechSynthesis.speak(msg)
  }
}

function setOption(){
  msg[this.name] = this.value;
  toggle();
}

speechSynthesis.addEventListener('voiceschanged', populateVoices)
voicesDropdown.addEventListener('change', setVoice)
options.forEach(option => {
  option.addEventListener('change', setOption)
})
speakButton.addEventListener('click', toggle.bind(null, false))
stopButton.addEventListener('click', toggle(false))
```